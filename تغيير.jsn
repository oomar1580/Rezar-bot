module.exports.config = {
    name: "Ø¬Ù„ÙØ§ÙˆÙŠ",
    version: "1.0.0",
    hasPermssion: 2, // Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    credits: "aziz",
    description: "ØªØºÙŠÙŠØ± ØµÙˆØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªØ±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§",
    commandCategory: "admin",
    usages: "ØªØºÙŠÙŠØ±_ØµÙˆØ±_Ø¨Ø±Ø¯ (Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ØµÙˆØ±Ø©)",
    cooldowns: 5
};

module.exports.run = async function ({ api, event }) {
    const fs = require("fs");
    const axios = require("axios");

    if (!event.messageReply || !event.messageReply.attachments || event.messageReply.attachments.length === 0) {
        return api.sendMessage("âŒ Ù„Ø§Ø²Ù… ØªØ±Ø¯ Ø¹Ù„Ù‰ ØµÙˆØ±Ø©!", event.threadID, event.messageID);
    }

    let attachment = event.messageReply.attachments[0];
    if (attachment.type !== "photo") {
        return api.sendMessage("âŒ Ù„Ø§Ø²Ù… ØªØ±Ø¯ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ù…Ø´ Ø­Ø§Ø¬Ø© Ø«Ø§Ù†ÙŠØ©!", event.threadID, event.messageID);
    }

    let imgPath = __dirname + "/temp_group_photo.jpg";

    try {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        let getImage = await axios.get(attachment.url, { responseType: "arraybuffer" });
        fs.writeFileSync(imgPath, Buffer.from(getImage.data, "binary"));

        api.sendMessage(`ğŸ–¼ï¸ Ø¬Ø§Ø±ÙŠ ØªØºÙŠÙŠØ± ØµÙˆØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª...`, event.threadID);

        const threads = await api.getThreadList(100, null, ["INBOX"]);
        let count = 0;

        for (const thread of threads) {
            if (thread.isGroup) {
                try {
                    await api.changeGroupImage(fs.createReadStream(imgPath), thread.threadID);
                    count++;
                } catch (err) {
                    console.error(`ÙØ´Ù„ ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${thread.threadID}`, err);
                }
            }
        }

        fs.unlinkSync(imgPath); // Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        api.sendMessage(`âœ… ØªÙ… ØªØºÙŠÙŠØ± ØµÙˆØ± ${count} Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©!`, event.threadID);

    } catch (error) {
        console.error(error);
        api.sendMessage("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±!", event.threadID);
    }
};
