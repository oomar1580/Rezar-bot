// ملف: spamImage.js
const axios = require("axios");

let spamImagesActive = false;

module.exports.config = {
    name: "سبام_صور",
    version: "1.0.0",
    hasPermssion: 2,
    credits: "aziz",
    description: "سبام صورة لكل المجموعات بالرد",
    commandCategory: "spam",
    usages: "(رد على صورة)",
    cooldowns: 5
};

module.exports.run = async function ({ api, event }) {
    if (!event.messageReply || !event.messageReply.attachments || event.messageReply.attachments[0].type !== "photo") {
        return api.sendMessage("📷 لازم ترد على صورة باش نخدم السبام!", event.threadID);
    }

    const imageUrl = event.messageReply.attachments[0].url;
    spamImagesActive = true;
    api.sendMessage("🚀 بدأ سبام الصور لكل الجروبات!", event.threadID);

    const sendToAllGroups = async () => {
        const threads = await api.getThreadList(100, null, ["INBOX"]);
        for (const thread of threads) {
            if (thread.isGroup && spamImagesActive) {
                try {
                    const img = (await axios.get(imageUrl, { responseType: "stream" })).data;
                    api.sendMessage({ attachment: img }, thread.threadID);
                } catch (err) {
                    console.error(err);
                }
            }
        }
    };

    while (spamImagesActive) {
        await sendToAllGroups();
        await new Promise(res => setTimeout(res, 5000)); // 5 ثواني بين الدورات
    }
};

module.exports.handleEvent = () => {}; // فارغ
module.exports.stopSpam = function ({ api, event }) {
    spamImagesActive = false;
    api.sendMessage("⛔ تم إيقاف سبام الصور!", event.threadID);
};
