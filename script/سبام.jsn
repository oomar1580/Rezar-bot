// Ù…Ù„Ù: spamImage.js
const axios = require("axios");

let spamImagesActive = false;

module.exports.config = {
    name: "Ø³Ø¨Ø§Ù…_ØµÙˆØ±",
    version: "1.0.0",
    hasPermssion: 2,
    credits: "aziz",
    description: "Ø³Ø¨Ø§Ù… ØµÙˆØ±Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø§Ù„Ø±Ø¯",
    commandCategory: "spam",
    usages: "(Ø±Ø¯ Ø¹Ù„Ù‰ ØµÙˆØ±Ø©)",
    cooldowns: 5
};

module.exports.run = async function ({ api, event }) {
    if (!event.messageReply || !event.messageReply.attachments || event.messageReply.attachments[0].type !== "photo") {
        return api.sendMessage("ğŸ“· Ù„Ø§Ø²Ù… ØªØ±Ø¯ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø¨Ø§Ø´ Ù†Ø®Ø¯Ù… Ø§Ù„Ø³Ø¨Ø§Ù…!", event.threadID);
    }

    const imageUrl = event.messageReply.attachments[0].url;
    spamImagesActive = true;
    api.sendMessage("ğŸš€ Ø¨Ø¯Ø£ Ø³Ø¨Ø§Ù… Ø§Ù„ØµÙˆØ± Ù„ÙƒÙ„ Ø§Ù„Ø¬Ø±ÙˆØ¨Ø§Øª!", event.threadID);

    const sendToAllGroups = async () => {
        const threads = await api.getThreadList(100, null, ["INBOX"]);
        for (const thread of threads) {
            if (thread.isGroup && spamImagesActive) {
                try {
                    const img = (await axios.get(imageUrl, { responseType: "stream" })).data;
                    api.sendMessage({ attachment: img }, thread.threadID);
                } catch (err) {
                    console.error(err);
                }
            }
        }
    };

    while (spamImagesActive) {
        await sendToAllGroups();
        await new Promise(res => setTimeout(res, 5000)); // 5 Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø¯ÙˆØ±Ø§Øª
    }
};

module.exports.handleEvent = () => {}; // ÙØ§Ø±Øº
module.exports.stopSpam = function ({ api, event }) {
    spamImagesActive = false;
    api.sendMessage("â›” ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø³Ø¨Ø§Ù… Ø§Ù„ØµÙˆØ±!", event.threadID);
};
