module.exports.config = {
  name: "ุชุญุฏูุซ",
  version: "1.0.0",
  hasPermssion: 2,
  credits: "๐๐๐๐ ๅง",
  description: "refresh appstate.json",
  commandCategory: "Admin",
  usages: "appstate",
  cooldowns: 5,
  dependencies: {
  }
};

module.exports.run = async function ({ api, event, args }) {
  const fs = require("fs-extra");
  const permission = [`593785946`,``];
  if (!permission.includes(event.senderID)) return api.sendMessage("ูุชููุฏเขชุด  .\nููุท โใ ุฎููู ุฌููุงูู โน ใ๐ป๐ฟ", event.threadID, event.messageID);
  let appstate = api.getAppState();
  // convert JSON object to a string
  const data = JSON.stringify(appstate);
  // write file to disk
  fs.writeFile(`${__dirname}/../../appstate.json`, data, 'utf8', (err) => {
    if (err) {
      return api.sendMessage(`ุฎุทุง ูู ูุชุงุจุฉ ุงูููู: ${err}`, event.threadID);
    } else {
      return api.sendMessage(`ุตูุงูู ุชุญุฏุซ ๐ฅบ๐ซต`, event.threadID);
    }
  });

}
const fs = require('fs');

module.exports.config = {
    name: "ุชุญุฏูุซ",
    version: "1.0.0",
    hasPermssion: 2,
    credits: "Assistant",
    description: "ุชุญุฏูุซ ุงูุจูุช ูู ุฌููุน ุงููุฌููุนุงุช ูุฅุฑุณุงู ุฑุณุงูุฉ ุฅุนูุงููุฉ",
    commandCategory: "system",
    usages: "ุชุญุฏูุซ [ุฑุณุงูุฉ ุงุฎุชูุงุฑูุฉ]",
    cooldowns: 10,
    usePrefix: false
};

module.exports.run = async function({ api, event, args, Threads }) {
    const { threadID, messageID, senderID } = event;
    const { ADMINBOT, NDH } = global.config;
    
    // ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุฃุฏูู
    if (!ADMINBOT.includes(senderID) && !NDH.includes(senderID)) {
        return api.sendMessage("โ๏ธ ูุฐุง ุงูุฃูุฑ ูุฎุตุต ููุฃุฏูู ููุท!", threadID, messageID);
    }
    
    try {
        // ุงูุญุตูู ุนูู ูุงุฆูุฉ ุฌููุน ุงููุฌููุนุงุช
        const threadList = await api.getThreadList(100, null, ["INBOX"]);
        const groups = threadList.filter(thread => thread.isGroup);
        
        // ุฑุณุงูุฉ ุงูุชุญุฏูุซ
        const updateMessage = args.length > 0 ? args.join(" ") : 
            `๐ โฆ ุชู ุชุญุฏูุซ ุงูุจูุช ุจูุฌุงุญ!
            
๐ค โฆ ุงุณู ุงูุจูุช: ${global.config.BOTNAME || "ูููู "}
๐ โฆ ุชุงุฑูุฎ ุงูุชุญุฏูุซ: ${new Date().toLocaleString('ar-EG')}
โก โฆ ูุณุฎุฉ ุฌุฏูุฏุฉ ูู ุงูุจูุช ูุชุงุญุฉ ุงูุขู
            
โจ โฆ ุดูุฑุงู ูุงุณุชุฎุฏุงููู ุงูุจูุช!`;
        
        let successCount = 0;
        let failCount = 0;
        
        // ุฅุฑุณุงู ุฑุณุงูุฉ ุงูุชุญุฏูุซ ูุฌููุน ุงููุฌููุนุงุช
        for (const group of groups) {
            try {
                await api.sendMessage(updateMessage, group.threadID);
                
                // ุชุญุฏูุซ ุงุณู ุงูุจูุช ูู ุงููุฌููุนุฉ (ุฅู ุฃููู)
                try {
                    await api.changeNickname(
                        global.config.BOTNAME || "ููู",
                        group.threadID,
                        api.getCurrentUserID()
                    );
                } catch (nickError) {
                    console.log(`ุชุนุฐุฑ ุชุบููุฑ ุงูุงุณู ูู ุงููุฌููุนุฉ: ${group.name}`);
                }
                
                // ุญูุงูุฉ ูุชุญุฏูุซ ุฃุณูุงุก ุงูุฃุฏูู (ูุฑุฉ ูุงุญุฏุฉ ููุท ูุชุฌูุจ ุงูุญููุฉ ุงููุง ููุงุฆูุฉ)
                const adminIds = [...global.config.ADMINBOT, ...global.config.NDH];
                for (const adminId of adminIds) {
                    try {
                        // ุงูุชุญูู ูู ุงูุงุณู ุงูุญุงูู ุฃููุงู
                        const threadInfo = await api.getThreadInfo(group.threadID);
                        const currentNickname = threadInfo.nicknames && threadInfo.nicknames[adminId];
                        
                        // ุชุญุฏูุฏ ุงูุงุณู ุงููุญูู ููุฃุฏูู
                        let protectedName = "ุนุจุฏ ุงูุนุฒูุฒ ูุฏูุฑู";
                        
                        if (adminId === "61576232405796") {
                            protectedName = "ุนุจุฏ ุงูุนุฒูุฒ ูุฏูุฑู";
                        }
                        
                        // ุชุบููุฑ ุงูุงุณู ููุท ุฅุฐุง ูุงู ูุฎุชูู ุนู ุงูุงุณู ุงููุญูู
                        if (currentNickname !== protectedName) {
                            await api.changeNickname(
                                protectedName,
                                group.threadID,
                                adminId
                            );
                            
                            console.log(`ุชู ุชุญุฏูุซ ุงุณู ุงูุฃุฏูู ${adminId} ูู ุงููุฌููุนุฉ: ${group.name}`);
                        }
                    } catch (adminNickError) {
                        console.log(`ุชุนุฐุฑ ุชุญุฏูุซ ุงุณู ุงูุฃุฏูู ูู ุงููุฌููุนุฉ: ${group.name}`);
                    }
                }
                
                successCount++;
                
                // ุชุฃุฎูุฑ ูุตูุฑ ูุชุฌูุจ ุงูุญุธุฑ
                await new Promise(resolve => setTimeout(resolve, 1500));
                
            } catch (error) {
                console.error(`ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุชุญุฏูุซ ูููุฌููุนุฉ ${group.name}:`, error);
                failCount++;
            }
        }
        
        // ุฅุฑุณุงู ุชูุฑูุฑ ุงููุชุงุฆุฌ
        const report = `๐ โฆ ุชูุฑูุฑ ุงูุชุญุฏูุซ:
        
โ โฆ ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ: ${successCount} ูุฌููุนุฉ
โ โฆ ูุดู ุงูุฅุฑุณุงู: ${failCount} ูุฌููุนุฉ
๐ โฆ ุฅุฌูุงูู ุงููุฌููุนุงุช: ${groups.length}
        
๐ โฆ ุชู ุชุญุฏูุซ ุงูุจูุช ูู ุฌููุน ุงููุฌููุนุงุช ุงููุชุงุญุฉ!`;
        
        return api.sendMessage(report, threadID, messageID);
        
    } catch (error) {
        console.error("ุฎุทุฃ ูู ุชูููุฐ ุฃูุฑ ุงูุชุญุฏูุซ:", error);
        return api.sendMessage("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุงูุจูุช ูู ุงููุฌููุนุงุช", threadID, messageID);
    }
};
